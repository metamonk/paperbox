# W2.D12 Horizontal Scroll Fix

**Date**: 2025-10-17
**Issue**: Horizontal scroll wheel not working for canvas pan
**Status**: ✅ FIXED

## Problem

User reported: "Horizontal scroll wheel does not work"

The implementation only used `event.deltaY` (vertical scroll) and ignored `event.deltaX` (horizontal scroll from trackpad or horizontal mouse wheel).

## Root Cause

In [FabricCanvasManager.ts:984-989](../src/lib/fabric/FabricCanvasManager.ts#L984-L989), the `handleScrollPan` function only checked:
- `event.shiftKey` to determine horizontal vs vertical pan
- Only used `delta` parameter (which was `event.deltaY`)
- Never read `event.deltaX`

This meant:
- ✅ Vertical scroll → Pan up/down (worked)
- ✅ Shift + Vertical scroll → Pan left/right (worked)
- ❌ Horizontal scroll → No effect (broken)

## Fix Applied

Modified `handleScrollPan()` to read both `deltaX` and `deltaY`:

```typescript
// BEFORE (only deltaY)
const panX = event.shiftKey ? delta : 0;
const panY = event.shiftKey ? 0 : delta;

// AFTER (deltaX + deltaY)
const deltaX = event.deltaX;
const deltaY = event.deltaY;

let panX = deltaX; // Trackpad horizontal scroll
let panY = deltaY; // Trackpad vertical scroll

// Shift modifier: Convert vertical scroll to horizontal pan
if (event.shiftKey) {
  panX = deltaY;
  panY = 0;
}
```

## Scroll Behavior Matrix

| Input | deltaX | deltaY | Shift | Result |
|-------|--------|--------|-------|--------|
| Vertical scroll | 0 | ±N | No | Pan up/down (Y) |
| Horizontal scroll | ±N | 0 | No | Pan left/right (X) |
| Shift + Vertical | 0 | ±N | Yes | Pan left/right (X) |
| Shift + Horizontal | ±N | 0 | Yes | Pan left/right (X) |
| Diagonal scroll | ±N | ±M | No | Pan both X and Y |

## Testing

**Refresh browser** and test:

1. **Vertical scroll** → Canvas pans up/down, Pan Y changes
2. **Horizontal scroll** (trackpad two-finger left/right OR horizontal mouse wheel) → Canvas pans left/right, Pan X changes
3. **Shift + Vertical scroll** → Canvas pans left/right, Pan X changes
4. **Diagonal scroll** (trackpad) → Canvas pans both directions

**Console logs** will show both deltaX and deltaY:
```javascript
[FabricCanvasManager] mouse:wheel: {
  deltaX: 10,    // Horizontal scroll amount
  deltaY: 0,     // Vertical scroll amount
  shiftKey: false,
  metaKey: false,
  ctrlKey: false,
  isZoomModifier: false,
  action: 'PAN'
}
```

## Files Changed

### FabricCanvasManager.ts

**handleScrollPan()** (lines 978-1020):
- Added `deltaX` and `deltaY` extraction
- Changed pan direction logic to support horizontal scroll
- Updated comments to document behavior

**Console logging** (lines 960-968):
- Added `deltaX` to debug output
- Added `shiftKey` to debug output

## Success Criteria

✅ Horizontal scroll (trackpad) works
✅ Horizontal mouse wheel works (if hardware supports)
✅ Shift + Vertical scroll still works
✅ Vertical scroll still works
✅ Diagonal scroll pans both X and Y
✅ Console logs show both deltaX and deltaY

## Technical Notes

### WheelEvent Properties

```typescript
interface WheelEvent {
  deltaX: number;  // Horizontal scroll amount (-left, +right)
  deltaY: number;  // Vertical scroll amount (-up, +down)
  deltaZ: number;  // Z-axis scroll (rarely used)
  shiftKey: boolean;
  ctrlKey: boolean;
  metaKey: boolean;
}
```

### Natural Scroll Direction

The code applies negative pan to match natural scrolling:
```typescript
newPanX = vpt[4] - panX;  // Negative = natural scroll
newPanY = vpt[5] - panY;  // Negative = natural scroll
```

This means:
- Scroll right (`deltaX > 0`) → Canvas pans right (content moves left)
- Scroll down (`deltaY > 0`) → Canvas pans down (content moves up)

### Trackpad vs Mouse Wheel

**Trackpad**:
- Two-finger horizontal swipe → `deltaX` values
- Two-finger vertical swipe → `deltaY` values
- Diagonal swipe → Both `deltaX` and `deltaY`

**Mouse Wheel**:
- Standard scroll → `deltaY` values only
- Horizontal tilt wheel → `deltaX` values (if hardware supports)
- Shift + Standard scroll → Still `deltaY`, handled by Shift key logic
